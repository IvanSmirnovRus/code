Массив из N чисел a[i]
[L, R]
Количество отрезков сумма элементов лежит в отрезке [L, R]

1 Перебрать все отрезки O(n3)
2 Построить сумму префиксов(partial_sum) за O(n), и перебрать все разницы 
3 Если все числа положительные, то последовательность возврастающая. Находим индекс i когда больше или равно L и j когда меньше и равно R. Тогда ответ для отреза начинающегося в первом элементе = разница индексов j-i + 1. Перещитываем индекс с учетом что начало сдвигаем на один элемнт вправо
4 Если отрицательные элементы можно отсортировать, делим попалам(в одной стороне ходит i, в другой j) и каждую половину сортируем и считаем алгоритм из пунтка 3

Решение через сбалансированное дерево или дерево отрезков